From: SNTP BLOCKER TEAM <developer@sntpblocker.dev>
Subject: [PATCH] frameworks/base: add SntpBlockerService skeleton and register in SystemServer
Date: Thu, 13 Nov 2025 11:00:00 +0000

---
 frameworks/base/services/core/java/com/android/server/sntpblocker/SntpBlockerService.java | 116 +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 frameworks/base/services/core/java/com/android/server/sntpblocker/ISntpBlockerService.aidl |  24 ++++++++++++++++++++++++
 frameworks/base/services/core/java/com/android/server/SystemServer.java                     |  12 ++++++------
 3 files changed, 142 insertions(+), 10 deletions(-)
 create mode 100644 frameworks/base/services/core/java/com/android/server/sntpblocker/SntpBlockerService.java
 create mode 100644 frameworks/base/services/core/java/com/android/server/sntpblocker/ISntpBlockerService.aidl

diff --git a/frameworks/base/services/core/java/com/android/server/sntpblocker/SntpBlockerService.java b/frameworks/base/services/core/java/com/android/server/sntpblocker/SntpBlockerService.java
new file mode 100644
index 000000000..aaaaaaaaa
--- /dev/null
+++ b/frameworks/base/services/core/java/com/android/server/sntpblocker/SntpBlockerService.java
@@ -0,0 +1,116 @@
+package com.android.server.sntpblocker;
+
+import android.content.Context;
+import android.os.IBinder;
+import android.os.RemoteException;
+import android.os.Binder;
+import android.os.ServiceManager;
+import android.util.Slog;
+
+import com.android.server.SystemService;
+
+import java.util.ArrayList;
+import java.util.List;
+
+/**
+ * SntpBlockerService - minimal production-ready skeleton for v1
+ * - publishes binder service "sntp_blocker"
+ * - stores blocked app list in memory (persistence added later)
+ * - offers dnsLock flag (UI disable behavior for v1)
+ */
+public final class SntpBlockerService extends SystemService {
+    private static final String TAG = "SntpBlockerService";
+    private final Context mContext;
+    private final List<String> mBlockedPackages = new ArrayList<>();
+    private boolean mDnsLockEnabled = false;
+
+    public SntpBlockerService(Context context) {
+        super(context);
+        mContext = context;
+    }
+
+    @Override
+    public void onStart() {
+        Slog.i(TAG, "Starting SntpBlockerService");
+        publishBinderService("sntp_blocker", new BinderImpl());
+    }
+
+    private final class BinderImpl extends ISntpBlockerService.Stub {
+        @Override
+        public void setBlockedApps(List<String> packages) {
+            synchronized (mBlockedPackages) {
+                mBlockedPackages.clear();
+                if (packages != null) mBlockedPackages.addAll(packages);
+            }
+            Slog.i(TAG, "Blocked apps updated: " + mBlockedPackages.size());
+        }
+
+        @Override
+        public List<String> getBlockedApps() {
+            synchronized (mBlockedPackages) {
+                return new ArrayList<>(mBlockedPackages);
+            }
+        }
+
+        @Override
+        public void enableDnsLock(boolean enable) {
+            mDnsLockEnabled = enable;
+            Slog.i(TAG, "DNS lock set to: " + enable);
+        }
+
+        @Override
+        public boolean isDnsLockEnabled() {
+            return mDnsLockEnabled;
+        }
+
+        @Override
+        public boolean isPackageBlocked(String pkg) {
+            synchronized (mBlockedPackages) {
+                return mBlockedPackages.contains(pkg);
+            }
+        }
+    }
+}
+
diff --git a/frameworks/base/services/core/java/com/android/server/SystemServer.java b/frameworks/base/services/core/java/com/android/server/SystemServer.java
index bbbbbbbbb..ccccccccc 100644
--- a/frameworks/base/services/core/java/com/android/server/SystemServer.java
+++ b/frameworks/base/services/core/java/com/android/server/SystemServer.java
@@ -123,14 +123,16 @@ public final class SystemServer {
             }
 
             Slog.i(TAG, "Start services");
 
-            // existing service starts...
+            // existing service starts...
             startBootstrapServices();
             startCoreServices();
 
+            // Start SNTP Blocker service (try/catch to avoid boot failure on unexpected errors)
+            try {
+                Slog.i(TAG, "Attempting to start SntpBlockerService");
+                SntpBlockerService sntpService = new SntpBlockerService(context);
+                sntpService.onStart();
+            } catch (Throwable t) {
+                Slog.w(TAG, "Failed to start SntpBlockerService: " + t);
+            }
+
             // continue with rest of system server startup...
